name: Build

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  release:
    types: [ created ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    permissions:
      contents: write
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up MSVC
      uses: ilammy/msvc-dev-cmd@v1
      with:
        arch: x64
    
    - name: Build
      run: cl.exe /EHsc /Fe:Patcher.exe Patcher.cpp
    
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: Patcher
        path: Patcher.exe
    
    - name: Upload to Release
      if: github.event_name == 'release'
      uses: softprops/action-gh-release@v1
      with:
        files: Patcher.exe
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
